---
title: C++ const 到底表示什么
date: 2018-03-14 13:35:46
tags:
 - C/CPP
---

这两天在看《CLR via C#》一书，发现C#在语法上区分了常量和只读两个概念，使用`const`关键字表示只读，使用`readonly`关键字表示只读。我当时转念一想，C++中对应的`const`如何表达这两种概念呢？细思之下发现，C++里面这个问题比我想象中的要复杂很多，特意写一篇文章记录一下。

<!--more-->

# 常量不等于常量表达式

我觉得弄清楚这个问题的关键点在于区分常量和常量表达式这个概念。我们可以用下面这个例子来说明：

```
const int size = 7;
int days[size];
```

上面这段代码在`C++`中是合法的（虽然你可能更应该使用`std::array`），但是在C99之前是不合法的（C99运行变长数组，和这里讨论的问题不属于同一个范畴）。原因很简单，数组的长度必须是常量表达式。

# 什么是常量表达式

上面这段代码，C89之所以无法编译通过是因为`size`不是常量表达式（没错，并不是因为
`const int size = 7`不是常量表达式）。而C++认为`size`是一个常量表达式。

常量表达是这个概念在C++和C规范中的定义有比较大的区别，有兴趣的同学可以查看一下下面这两个链接：

[C++ 常量表达式](http://en.cppreference.com/w/cpp/language/constant_expression)
[C 常量表达式](http://en.cppreference.com/w/c/language/constant_expression)

C标准里面给常量表达式下明确的定义，只是列举了几类可以称为常量表达式的表达式，C++中常量表达式则明确给了如下的定义：

> Defines an expression that can be evaluated at compile time

所以在C++中，上面的代码之所以可以合法，是因为`size`可以在编译期间知道它的值。（C里面为什么不把它当做常量表达式实际上有历史原因。起初C里面并没有const，所有的对象都是变量，后来引入了const，也只是修饰变量，表示这个变量只读，而不是表示这个对象是个常量）。

# const 的作用是什么呢？


